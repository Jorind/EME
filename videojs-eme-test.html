<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Video.js DRM EME Test</title>
  <link href="https://unpkg.com/video.js@8.17.4/dist/video-js.min.css" rel="stylesheet" />
  <script src="https://unpkg.com/video.js@8.17.4/dist/video.min.js"></script>
  <script src="https://unpkg.com/videojs-contrib-eme@5.5.1/dist/videojs-contrib-eme.min.js"></script>
  <style>
    body { background: #111; color: #fff; font-family: sans-serif; text-align: center; padding: 2rem; }
    video { width: 80%; margin-top: 2rem; }
  </style>
</head>
<body>

  <h1>Video.js DRM EME Test (v8.17.4 / v5.5.1)</h1>

  <video
    id="drm-video"
    class="video-js vjs-default-skin"
    controls
    preload="auto"
    playsinline
    crossorigin="anonymous"
  ></video>

  <script>
    const player = videojs('drm-video');

    player.ready(function () {
      player.eme(); // Enable EME plugin

      player.src({
        src: 'https://content-cdn-drm.dev.grapeseed.com/a4b142bc-c314-4420-95e1-9e2a65062588/LSv1-U4-REP-Be-Like-a-Baby.m3u8', // DASH for Widevine, HLS for FairPlay
        type: 'application/vnd.apple.mpegurl', // Use 'application/dash+xml' for non HLS  application/vnd.apple.mpegurl for hls
        keySystems: {
          'com.widevine.alpha': {
            url: 'https://drm-widevine-licensing.axprod.net/AcquireLicense',
            licenseHeaders: { 'X-AxDRM-Message': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ2ZXJzaW9uIjoxLCJjb21fa2V5X2lkIjoiODIyOGEwMDUtMjk0OS00ZmU4LWEwY2EtYjIzNDAwYjE3NDYwIiwibWVzc2FnZSI6eyJ0eXBlIjoiZW50aXRsZW1lbnRfbWVzc2FnZSIsInZlcnNpb24iOjIsImxpY2Vuc2UiOnsiYWxsb3dfcGVyc2lzdGVuY2UiOnRydWUsImZlYXR1cmVzIjpbImZlYXR1cmUxIiwiZmVhdHVyZTIiLCJmZWF0dXJlMyJdLCJmYWlycGxheSI6eyJyZWFsX3RpbWVfZXhwaXJhdGlvbiI6dHJ1ZX0sInBsYXlyZWFkeSI6eyJyZWFsX3RpbWVfZXhwaXJhdGlvbiI6dHJ1ZX19LCJjb250ZW50X2tleXNfc291cmNlIjp7ImlubGluZSI6W3siaWQiOiJiZmE4MzQwYy1iZjFjLWQ4OGYtNGE4NC1hYzc5NGU0YmMzYTUiLCJ1c2FnZV9wb2xpY3kiOiJQb2xpY3lBIn1dfSwiY29udGVudF9rZXlfdXNhZ2VfcG9saWNpZXMiOlt7Im5hbWUiOiJQb2xpY3lBIiwid2lkZXZpbmUiOnsiZGV2aWNlX3NlY3VyaXR5X2xldmVsIjoiU1dfU0VDVVJFX0NSWVBUTyJ9fSx7Im5hbWUiOiJQb2xpY3lCIiwid2lkZXZpbmUiOnsiZGV2aWNlX3NlY3VyaXR5X2xldmVsIjoiU1dfU0VDVVJFX0RFQ09ERSJ9fV19fQ._AqA2PTcXRPjVQVrO1NS8E3bN8hhTabp5lg7GVER84s' },
          },
          'com.apple.fps': {
            certificateUri: 'https://content-cdn-drm.dev.grapeseed.com/fairplay-certificate/fairplay.cer',
            licenseUri: 'https://drm-fairplay-licensing.axprod.net/AcquireLicense',
            getContentId: function (emeOptions, initData) {
              const uri = new TextDecoder().decode(initData);
              return uri.substring(uri.lastIndexOf('/') + 1);
            },
            getLicense: function (emeOptions, contentId, keyMessage, callback) {
              fetch(emeOptions.licenseUri, {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/octet-stream',
                  'Authorization':'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ2ZXJzaW9uIjoxLCJjb21fa2V5X2lkIjoiODIyOGEwMDUtMjk0OS00ZmU4LWEwY2EtYjIzNDAwYjE3NDYwIiwibWVzc2FnZSI6eyJ0eXBlIjoiZW50aXRsZW1lbnRfbWVzc2FnZSIsInZlcnNpb24iOjIsImxpY2Vuc2UiOnsiYWxsb3dfcGVyc2lzdGVuY2UiOnRydWUsImZlYXR1cmVzIjpbImZlYXR1cmUxIiwiZmVhdHVyZTIiLCJmZWF0dXJlMyJdLCJmYWlycGxheSI6eyJyZWFsX3RpbWVfZXhwaXJhdGlvbiI6dHJ1ZX0sInBsYXlyZWFkeSI6eyJyZWFsX3RpbWVfZXhwaXJhdGlvbiI6dHJ1ZX19LCJjb250ZW50X2tleXNfc291cmNlIjp7ImlubGluZSI6W3siaWQiOiJiZmE4MzQwYy1iZjFjLWQ4OGYtNGE4NC1hYzc5NGU0YmMzYTUiLCJ1c2FnZV9wb2xpY3kiOiJQb2xpY3lBIn1dfSwiY29udGVudF9rZXlfdXNhZ2VfcG9saWNpZXMiOlt7Im5hbWUiOiJQb2xpY3lBIiwid2lkZXZpbmUiOnsiZGV2aWNlX3NlY3VyaXR5X2xldmVsIjoiU1dfU0VDVVJFX0NSWVBUTyJ9fSx7Im5hbWUiOiJQb2xpY3lCIiwid2lkZXZpbmUiOnsiZGV2aWNlX3NlY3VyaXR5X2xldmVsIjoiU1dfU0VDVVJFX0RFQ09ERSJ9fV19fQ._AqA2PTcXRPjVQVrO1NS8E3bN8hhTabp5lg7GVER84s'
                },
                body: keyMessage
              })
              .then(response => {
                if (!response.ok) throw new Error('FairPlay license request failed');
                return response.arrayBuffer();
              })
              .then(license => callback(null, license))
              .catch(error => callback(error));
            }
          }
        }
      });
    });
  </script>
</body>
</html>
